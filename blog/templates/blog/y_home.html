{% extends 'blog/y_base.html' %}
{% block title %}Y-Frame | Home{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
  <div>
    <h2 class="mb-0">Blogs</h2>
    <div class="text-muted small">Explore latest published posts</div>
  </div>
</div>

<form method="get" class="card p-3 mb-3">
  <div class="row g-2 align-items-center">
    <div class="col-md-7">
      <input class="form-control" name="q" value="{{ q }}" placeholder="Search by title, excerpt, content..." />
    </div>

    <div class="col-md-3">
      <select class="form-select" name="cat">
        <option value="">All Categories</option>
        {% for c in categories %}
          <option value="{{ c.bc_category_id }}"
            {% if cat == c.bc_category_id|stringformat:"s" %}selected{% endif %}>
            {{ c.bc_category_name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2 d-flex gap-2">
      <button class="btn btn-dark w-100" type="submit">Search</button>
      <a class="btn btn-outline-secondary" href="{% url 'y_home' %}">Reset</a>
    </div>
  </div>
</form>

<!-- Category Chips -->
<div class="d-flex flex-wrap gap-2 mb-3">
  <a class="badge rounded-pill text-bg-light border {% if not cat %}active-chip{% endif %}"
     href="{% url 'y_home' %}?q={{ q|urlencode }}">
     All
  </a>

  {% for c in categories %}
    <a class="badge rounded-pill text-bg-light border {% if cat == c.bc_category_id|stringformat:'s' %}active-chip{% endif %}"
       href="{% url 'y_home' %}?cat={{ c.bc_category_id }}&q={{ q|urlencode }}">
       {{ c.bc_category_name }}
    </a>
  {% endfor %}
</div>

<!-- Blog Cards -->
<div class="row g-3">
  {% for b in blogs %}
    <div class="col-md-6 col-lg-4">
      <div class="card h-100 shadow-sm">
        {% if b.bd_featured_image %}
          <img src="{{ b.bd_featured_image }}" class="card-img-top"
               style="height:170px; object-fit:cover;" alt="cover">
        {% endif %}

        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="badge text-bg-secondary">{{ b.bd_blog_status }}</span>
            <span class="text-muted small">
              {{ b.bd_published_at|default:b.bd_updated_at }}
            </span>
          </div>

          <h5 class="card-title mb-2">{{ b.bd_blog_title }}</h5>

          <p class="card-text text-muted mb-3" style="min-height:52px;">
            {{ b.bd_excerpt|default:"No excerpt available."|truncatechars:90 }}
          </p>

          <div class="mt-auto d-flex justify-content-between align-items-center">
            <span class="text-muted small">Views: {{ b.bd_views }}</span>
            <a href="{% url 'y_blog_detail' b.bd_slug %}">Read More</a>
          </div>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12">
      <div class="alert alert-warning mb-0">
        No posts found. Try changing search/filter.
      </div>
    </div>
  {% endfor %}
</div>

<!-- ================= Pagination ================= -->
{% if page_obj.has_other_pages %}
  <nav class="mt-4">
    <ul class="pagination justify-content-center">

      <!-- Previous -->
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link"
             href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if cat %}&cat={{ cat }}{% endif %}">
             Previous
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      <!-- Page Numbers -->
      {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
          <li class="page-item active">
            <span class="page-link">{{ num }}</span>
          </li>
        {% elif num >= page_obj.number|add:-2 and num <= page_obj.number|add:2 %}
          <li class="page-item">
            <a class="page-link"
               href="?page={{ num }}{% if q %}&q={{ q }}{% endif %}{% if cat %}&cat={{ cat }}{% endif %}">
               {{ num }}
            </a>
          </li>
        {% endif %}
      {% endfor %}

      <!-- Next -->
      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link"
             href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if cat %}&cat={{ cat }}{% endif %}">
             Next
          </a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}

    </ul>
  </nav>
{% endif %}

{% endblock %}